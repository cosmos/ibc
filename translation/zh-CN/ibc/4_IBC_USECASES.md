# 4：IBC 用例

**这是区块链间通信协议的一组可能的应用层用例。**

**有关 IBC 规范中使用的术语的定义，请参见[此处](./1_IBC_TERMINOLOGY.md) 。**

**有关架构的概述，请参见[此处](./2_IBC_ARCHITECTURE.md) 。**

**有关广泛的协议设计原则，请参见[此处](./3_IBC_DESIGN_PRINCIPLES.md) 。**

**有关设计模式的讨论，请参见[此处](./5_IBC_DESIGN_PATTERNS.md) 。**

这是区块链间通信协议（IBC）可能的具体应用用例的详尽清单，在此列出的目的是为了启发并意图提供灵感和一些视角，以从这些角度评估设计协议。

对于每个用例，我们定义相关链的要求，高层次数据包处理逻辑，在相关链的组合状态视图中维护的应用程序属性以及潜在相关区域的不同对比优势或应用程序特性的列表。

## 资产转移

只要存在兼容的原生资产表示形式，IBC 即可用于在两个链之间转移资产。

### 同质化通证

IBC 可用于在链之间转移同质化通证。

#### 表现形式

比特币`UTXO` ，以太坊`ERC20` ，Cosmos SDK `sdk.Coins` 。

#### 实现

两条链选择相互“锚定”两个语义兼容的同质化通证面额，在发送和处理 IBC 数据包时根据需要进行托管，取消托管，铸造和销毁。

可能存在一个起始“源区域”，该区域起始时就拥有全部的通证数量，而“目标区域”起始时通证余额为零，或者两个区域起始时通证余额都不为零（也许来自于第三方拥有通证的区域），或者两个区域可以选择合并供应并提供两个和以前完全不同的通证作为替代。

#### 不变量

在所有锚定表示形式中任何数量的通证都具有同质性，在整个链中累积的总供给是恒定的（或对于通货膨胀资产而言是公式化的），并且通证同一时刻只能以一种可消费的形式存在于一个链上。

### 非同质化通证

IBC 可用于在链之间转移非同质化通证。

#### 表现形式

以太坊`ERC721` ，Cosmos SDK `sdk.NFT` 。

#### 实现

两条链选择相互“锚定”两个语义兼容的非同质化通证名称空间，在发送和处理 IBC 数据包时根据需要进行托管，取消托管，创建和销毁。

可能有一个初始的拥有一些特定通证的“源区域”，并包含与通证相关的逻辑（例如，繁殖加密猫，兑换数字票证），或者可以将相关的逻辑与 NFT 一起打包为所有相关链都能理解的格式。

#### 不变量

任何给定的非同质化通证在任何时间点都唯一的存在于一条链上的一个特定帐户里，并且在需要时，始终可以转移回“源”区域以执行关联的操作（例如，繁殖加密猫）。

### 涉及区域

#### 原生支付

诸如 Cosmos Hub 之类的“原生支付”区域可以允许通过 IBC 进行传入和传出同质化或/和非同质化通证。由于高安全性或高连接性，用户可能选择将资产保留在此类区域中。

#### 屏蔽支付

一个屏蔽支付区域，例如 Zcash 区块链（待处理的 [UIT](https://github.com/zcash/zcash/issues/830) ）可以允许通过 IBC 进行传入和传出同质化或/和非同质化通证。然后，可以通过零知识流程保护转移到此类区域的通证，并对其进行持有，转移，交易等。一旦用户完成了要求匿名的目的，就可以将其转移出去，并通过 IBC 转移回其他区域。

#### 去中心化交易所

“去中心化交易所”区域可以允许通过 IBC 进行传入和传出同质化或/和非同质化通证，并允许通过类 Uniswap 或 0x（或未来的此类协议）的去中心交易协议来交易存储在该区域上的通证。

#### 去中心化金融

以太坊区块链等“去中心化金融”区域可以允许通过 IBC 进行传入和传出同质化或/和非同质化通证，并允许存储在该区域中的通证与多种去中心化金融产品进行交互：合成稳定币，抵押贷款，流动性资金池等。

## 多链合约

IBC 可用于在分布在多个链中的合约逻辑之间传递消息和数据。

### 跨链合约调用

IBC 可用于在独立的智能合约平台链之间执行任意带有调用数据和返回数据的合约调用。

#### 表现形式

合约：以太坊 `EVM` ， `WASM` （各种），Tezos `Michelson` ，Agoric `Jessie` 。

调用数据：以太坊`ABI` ，通用序列化格式，例如 RLP，Protobuf 或 JSON。

#### 实现

一个合约如果打算调用另一个区域上的合约，必须在 IBC 数据包中序列化目标合约的调用数据和地址，该数据可以通过 IBC 连接中继到目标链上的 IBC 处理程序，该 IBC 处理程序将调用指定的合约，执行任何关联的逻辑，然后将调用结果（如果适用）包含到第二个 IBC 数据包中，返回给调用合约，该合约需要异步处理。

实现链时可以选择为合约开发人员提供“通道”对象，包括发送端，接收端，可配置的缓冲区大小等，这与使用 Go 或 Haskell 等语言进行的多进程并发编程中的通道非常相似。

#### 不变量

因合约而异。

### 跨链费用支付

#### 表现形式

与上述“同质化通证”相同。

#### 实现

使用一个链上持有的资产支付另一条链上的费用，可以通过将通证发送到第二条链的验证人集合控制的第一条链上的帐户上，并包含通证已发送（在第一条链上）的证明，一起在交易中提交给第二条链的方式实现。

资金可以定期通过 IBC 连接从第一条链发送回第二条链，以进行费用支付。

#### 不变量

只在其中一条链上支付正确的费用，不能同时在两条链上。

### 跨链抵押

一条链上的验证人集合的子集可以选择验证另一条链，并对通过 IBC 连接处理提交的该链产生的矛盾行为，第二条链可以通过同一 IBC 连接将其验证人更新逻辑委托给第一条链。

#### 表现形式

ABCI `Evidence`和`ValidatorUpdate` 。

#### 实现

主（抵押）链通过 IBC 数据包将包含验证人集合的参与子集的`ValidatorUpdate`中继到被抵押链，被抵押链直接使用它们设置自己的验证人集合。

任何矛盾行为都通过`Evidence`从被抵押链传回了主链，从而可以惩罚引起矛盾行为的验证人。

#### 不变量

犯有矛盾行为的验证人在至少一条链上是可以被惩罚的，并且可以将被抵押链的验证人集合绑定到主（抵押）链的验证人集合上。

## 分片

IBC 可以在具有相互理解的虚拟机和数据格式的区块链之间迁移智能合约和数据。

### 代码迁移

#### 表现形式

与上面的“跨链合约调用”相同，另外要求所有涉及的代码必须是可序列化的，并且在所涉及的链上可以相互理解（可执行）。

#### 实现

参与分片的链通过已知的平衡（“分片”）算法，在链之间迁移它们都可以执行的合约，这些算法可能旨在均衡负载或使局部频繁交互合约更加高效。

需要一个在核心 IBC 之上的路由系统来正确路由可能频繁切换链的合约之间的跨链调用。

#### 不变量

保留代码的语义，通过某种路由系统保留命名空间。

### 数据迁移

IBC 可用于实施任意深度的多链“缓存”系统，在该系统中，存储成本可以转变为访问成本。

#### 表现形式

通用序列化格式，例如 Amino，RLP，Protobuf，JSON。

#### 实现

一个任意深度的 IBC 连接链表链，其中第一个链针对计算进行优化，后来的链针对存储成本进行优化，就可以实现分层缓存，其中任何一条链上一段时间未使用的数据都将迁移到列表中的下一个链。当需要数据时（例如，用于合约调用或存储访问），如果在链中没有查找到，则必须通过 IBC 数据包将其中继回该链（然后可以将其重新缓存一段时间 ）。

#### 不变量

当请求时，所有数据都可以在主（计算）链上访问到，并具有一个 IBC 跳数的已知边界。
